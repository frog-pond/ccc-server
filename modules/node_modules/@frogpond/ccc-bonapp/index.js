import {get} from '@frogpond/ccc-lib'
import {JSDOM} from 'jsdom'

export async function cafe(cafeUrl) {
	let dom = await JSDOM.fromURL(cafeUrl, {runScripts: 'dangerously'})
	return dom.window.Bamco.dayparts
}

export async function nutrition(itemId) {
	let url = 'https://legacy.cafebonappetit.com/api/2/items'
	let resp = await get(url, {json: true, query: {item: itemId}})
	let itemInfo = Object.assign({}, resp.body)
	return itemInfo
}

export async function menu(cafeUrl) {
	let dom = await JSDOM.fromURL(cafeUrl, {runScripts: 'dangerously'})
	let days = dom.window.Bamco.days.map((dayInfo) => {
		let info = Object.assign({}, dayInfo)
		info.cafe = info.cafes[cafeUrl]
		delete info.cafes
		return info
	})
	return Object.assign({}, resp.body, {days})
}
