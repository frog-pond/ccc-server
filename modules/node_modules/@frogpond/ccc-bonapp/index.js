import {get} from '@frogpond/ccc-lib'
import {JSDOM} from 'jsdom'

export async function cafe(cafeUrl) {
	let dom = await JSDOM.fromURL(cafeUrl, {runScripts: 'dangerously'})
	return dom.window.Bamco.dayparts
}

export async function nutrition(itemId) {
	let url = 'https://legacy.cafebonappetit.com/api/2/items'
	return get(url, {searchParams: {item: itemId}}).json()
}

export async function menu(cafeUrl) {
	let dom = await JSDOM.fromURL(cafeUrl, {runScripts: 'dangerously'})
	let days = dom.window.Bamco.days.map((dayInfo) => {
		let info = Object.assign({}, dayInfo)
		info.cafe = info.cafes[cafeUrl]
		delete info.cafes
		return info
	})
	return Object.assign({}, resp.body, {days})
}
